<!DOCTYPE html>
<html lang="en">

  <head>
    <!--每个页面都需要 head link等  -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>
  Software Engineering for Systems Hackers - Nuo&#39;s Blog
</title>
<link rel="shortcut icon" href="https://blog.qxxiao.eu.org/favicon.ico">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css">
<link rel="stylesheet" href="https://blog.qxxiao.eu.org/media/css/tailwind.css">
<link rel="stylesheet" href="https://blog.qxxiao.eu.org/media/css/ldbutton.css">

<link rel="stylesheet" href="https://blog.qxxiao.eu.org/styles/main.css">
<script src="https://blog.qxxiao.eu.org/media/scripts/initTheme.js"></script>
<link rel="stylesheet" href="https://blog.qxxiao.eu.org/media/css/light-dark.css">

<link rel="alternate" type="application/atom+xml" title="Software Engineering for Systems Hackers - Nuo&#39;s Blog - Atom Feed"
  href="https://blog.qxxiao.eu.org/atom.xml">


      <meta name="description" content="版本控制
概念：

主副本存储在版本库中
每个版本都是可用的
多开发分支
并行开发

构建工具和自动化
更容易构建意味着更容易测试和修改；更容易测试和修改意味着更快乐的程序和更快乐的程序员。
Makefiles
Make的几个重要功能:

..." />
      <meta property="og:title" content="Software Engineering for Systems Hackers - Nuo&#39;s Blog" />
      <meta property="og:description" content="版本控制
概念：

主副本存储在版本库中
每个版本都是可用的
多开发分支
并行开发

构建工具和自动化
更容易构建意味着更容易测试和修改；更容易测试和修改意味着更快乐的程序和更快乐的程序员。
Makefiles
Make的几个重要功能:

..." />
      <meta property="og:type" content="articles" />
      <meta property="og:url" content="https://blog.qxxiao.eu.org/post/software-engineering-for-systems-hackers/" />
      <meta property="og:image"
        content="https://blog.qxxiao.eu.org/images/avatar.png" />
      <meta property="og:image:height" content="630" />
      <meta property="og:image:width" content="1200" />
      <meta name="twitter:title" content="Software Engineering for Systems Hackers - Nuo&#39;s Blog" />
      <meta name="twitter:description" content="版本控制
概念：

主副本存储在版本库中
每个版本都是可用的
多开发分支
并行开发

构建工具和自动化
更容易构建意味着更容易测试和修改；更容易测试和修改意味着更快乐的程序和更快乐的程序员。
Makefiles
Make的几个重要功能:

..." />
      <meta name="twitter:card" content="summary_large_image" />
      <link rel="canonical" href="https://blog.qxxiao.eu.org/post/software-engineering-for-systems-hackers/" />

      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css" />
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css" />

      
        <link rel="stylesheet"
          href="https://blog.qxxiao.eu.org/media/css/prism-vs-dark.css" />
        <link href="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/line-numbers/prism-line-numbers.min.css"
          rel="stylesheet" />
        <link href="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/toolbar/prism-toolbar.min.css"
          rel="stylesheet" />
        
          
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" />
            
  </head>

  <body>
    <div class="antialiased flex flex-col min-h-screen" id="app">
      <!-- 标题菜单 -->
<div class="nav py-3 md:py-8 fixed w-full z-10 bg-gray-50 dark:bg-gray-700 transition-all duration-300"
  :class="{ 'scroll': scrolled }">
  <div class="flex justify-end px-4">
    <div class="w-8 h-8 flex justify-center items-center rounded-full md:hidden" @click="showMenu = !showMenu">
      <i class="ri-close-line" v-show="showMenu"></i>
      <i class="ri-menu-3-line" v-show="!showMenu"></i>
    </div>
  </div>
  <nav cloak class="max-w-4xl w-full mx-auto text-right flex flex-col md:flex-row justify-between items-center md:flex"
    :class="`${ showMenu ? 'flex' : 'hidden' }`">
    
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
          <a href="/" target=""
            class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
            首页
          </a>
          
            
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
          <a href="/archives" target=""
            class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
            归档
          </a>
          
            
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
          <a href="/tags" target=""
            class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
            标签
          </a>
          
            
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
          <a href="https://gh.qxxiao.cn/nav" target=""
            class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
            导航
          </a>
          
            
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
        <div
          class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold dark:hover:bg-gray-600 hover:bg-gray-200 nav-time1">
          时光
            <div class="transition font-semibold nav-time2">
              
                <a href="https://blog.qxxiao.eu.org/diary/" class="">
                  说说
                </a>
                
                <a href="https://blog.qxxiao.eu.org/gallery/" class="">
                  相册
                </a>
                
                <a href="https://blog.qxxiao.eu.org/post/book/" class="">
                  书单
                </a>
                
            </div>
        </div>
        
            
      <!-- 如果 menu 是 "时光"， 渲染为一个hover显示下拉框组件-->
      
          <a href="/post/about" target=""
            class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
            关于
          </a>
          
            
              <!-- <a href="https://blog.qxxiao.eu.org/atom.xml" target="_blank" class="py-2 md:py-1 px-4 mx-4 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
      RSS
    </a> -->
              <!-- 黑色模式，和亮色模式开关-->
<div class="py-2 md:py-1 inline-flex transition font-semibold rounded dark:hover:bg-gray-600 hover:bg-gray-200">
  <label for="night-light-checkbox" class="night-light-label">
    <input type="checkbox" id="night-light-checkbox" @change="toggleDarkMode" />
    <span v-cloak class="night-light-ball" id="night-light-ball"></span>
    <svg viewBox="0 0 512 512" class="sun-svg">
      <path id="sun-svg"
        d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z">
      </path>
    </svg>
    <svg viewBox="0 0 512 512" class="moon-svg">
      <path id="moon-svg"
        d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z">
      </path>
    </svg>
  </label>
</div>
                <form id="gridea-search-form" class="inline-flex mx-4 px-4" action="https://blog.qxxiao.eu.org/search/">
                  <input type="search" autocomplete='off' spellcheck='false' name="q" />
                </form>
  </nav>

</div>
        <a href="https://blog.qxxiao.eu.org"
          class="fixed top-0 left-0 mt-4 bg-black text-white dark:text-gray-700 dark:bg-yellow-50 dark:hover:bg-black dark:hover:text-white inline-flex p-2 pl-8 hover:text-gray-700 hover:bg-yellow-50 font-bold z-10">
          Nuo&#39;s Blog
        </a>
        <div class="max-w-4xl w-full mx-auto">
          <div class="shadow-box bg-white dark:bg-gray-600 rounded-lg pt-32 px-4 md:px-8 pb-8 mb-8">
            <h1 class="text-5xl font-semibold leading-normal pb-8 mb-8 border-b-8 border-gray-700">
              Software Engineering for Systems Hackers
            </h1>
            
                <div class="mb-8 flex flex-wrap">
                  <div class="text-gray-400 text-sm mr-4">
                    <i class="ri-calendar-2-line" style="vertical-align: middle;"></i>
                    2022-04-30 ·
                      <i class="ri-file-word-line" style="vertical-align: middle;"></i>
                      3145字 ·
                        <i class="ri-timer-line" style="vertical-align: middle;"></i>
                        12 min read
                  </div>
                  🏷️&nbsp;
                      
                        <a href="https://blog.qxxiao.eu.org/tag/article/"
                          class="text-indigo-500 text-sm border-b-2 border-solid border-indigo-500 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
                          <i class="ri-hashtag" style="vertical-align: middle;"></i>
                          Article
                        </a>
                        
                        <a href="https://blog.qxxiao.eu.org/tag/c/"
                          class="text-indigo-500 text-sm border-b-2 border-solid border-indigo-500 hover:border-gray-600 transition-all duration-100 inline-flex mr-2">
                          <i class="ri-hashtag" style="vertical-align: middle;"></i>
                          C++
                        </a>
                        
                </div>
                <div class="markdown mb-8" v-pre><h2 id="版本控制">版本控制</h2>
<p>概念：</p>
<ul>
<li>主副本存储在版本库中</li>
<li>每个版本都是可用的</li>
<li>多开发分支</li>
<li>并行开发</li>
</ul>
<h2 id="构建工具和自动化">构建工具和自动化</h2>
<p>更容易构建意味着更容易测试和修改；更容易测试和修改意味着更快乐的程序和更快乐的程序员。</p>
<h3 id="makefiles">Makefiles</h3>
<p>Make的几个重要功能:</p>
<ul>
<li>
<p>默认是第一个目标target</p>
</li>
<li>
<p>隐式编译规则</p>
<p>例如，将.c文件编译成.o文件。根据惯例，该隐含规则使用变量CFLAGS来定义C编译标志。</p>
</li>
<li>
<p>变量</p>
<p><code>CFLAGS=-Wall -g</code>，<code>CC</code></p>
</li>
<li>
<p>特殊变量</p>
<p>makeﬁle使用特殊变量<code>$@</code>，这个特殊变量表示 &quot;目标&quot;。特殊变量可以避免不必要的输入，并使规则更容易改变和重复使用。</p>
</li>
</ul>
<h3 id="example">Example</h3>
<p>包含一个main程序和2个lib项目的Makefile:</p>
<ul>
<li><strong>prog.c:</strong> The main program ﬁle</li>
<li><strong>lib.c</strong>: Lib#1 c file</li>
<li><strong>lib.h</strong>: Lib#1 header file</li>
<li><strong>lib_test.c</strong>: a set of tests for Library #1</li>
<li><strong>lib2.c</strong>: Lib#2 c file</li>
<li><strong>lib2.h:</strong> Lib#2 header file</li>
<li><strong>lib2_test.c:</strong> a set of tests for Library #2</li>
<li><strong>tests.h</strong>: A header ﬁle for some common test functions</li>
<li><strong>tests.c</strong>: A library with some useful test routines</li>
</ul>
<pre><code class="language-makefile">CC=gcc
CFLAGS=-Wall -g
LIBS=lib.o lib2.o
HEADERS=lib.h lib2.h
BINS=prog lib_test lib2_test

all: ${BINS}

prog: prog.o ${LIBS} ${HEADERS}
	${CC} -o $@ ${CFLAGS} prog.o ${LIBS}

lib_test: lib.o lib_test.o lib.h tests.o tests.h
	${CC} -o $@ ${CFLAGS} lib_test.o lib.o tests.o

lib2_test: lib2.o lib2_test.o lib2.h tests.o tests.h
	${CC} -o $@ ${CFLAGS} lib2_test.o lib2.o tests.o

test:
	./lib_test
	./lib2_test

clean:
	rm -rf ${BINS} *.o core *.core
</code></pre>
<h2 id="工具">工具</h2>
<h3 id="代码检查">代码检查</h3>
<ul>
<li>
<p>编译器检查</p>
<p>总是使用gcc -Wall</p>
</li>
<li>
<p>用**<code>-D_FORTIFY_SOURCE</code>**及早发现错误</p>
<p>用<code>-D_FORTIFY_SOURCE=2</code>编译程序将包括对系统调用（如printf）的缓冲区对齐的额外检查。这些检查决定了你是否向sprintf等函数传递了一个太小的缓冲区。</p>
</li>
<li>
<p>使用glibc变量及早发现错误</p>
<p>设置环境变量 <code>MALLOC_CHECK_</code> 来识别 malloc 相关的问题，如果设置为1会记录错误，设置为2会导致立即终止。</p>
</li>
</ul>
<h2 id="调试">调试</h2>
<h3 id="调试思维模式">调试思维模式</h3>
<p>一些有用的调试步骤：</p>
<ul>
<li>使用堆栈跟踪</li>
<li>检查最近的修改</li>
<li>仔细阅读代码</li>
<li>向别人解释你的代码</li>
<li>让错误可以重现
<ul>
<li>增加一致性检查，找出你对程序状态的假设出错的地方；</li>
<li>增加调试输出，以显示程序的特定位的状态，或确定程序的哪些部分在崩溃前被到达；</li>
<li>删除可能导致错误/崩溃/等的部分代码，看看它们是否真的有责任；</li>
</ul>
</li>
</ul>
<p>发现bug后需要思考的是：</p>
<ol>
<li>是否在代码的其他地方犯了这个错误？由于对接口的误解而产生的bug，很可能会在多个地方出现。做一次快速检查，以主动消除其他bug。</li>
<li>怎样才能避免在将来犯这个错误？你也许可以添加测试用例来自动发现它们，在代码中添加断言来检测该错误是否再次发生，使用编译器警告来自动检测它们，或者改变你写代码的方式，使其不可能犯错。</li>
</ol>
<h3 id="printf调试宏">Printf：调试宏</h3>
<p>调试宏可以在程序中增加调试printfs而不用移除。一组好的调试宏可以有选择的启用和关闭不同级别的调试级别。通常指定输出信息的方式有两种：调试级别和指定调试的功能（socket 操作，进程相关）。</p>
<details>
<summary>debug.h</summary>  
<pre><code class="language-cpp">#ifndef _DEBUG_H_
#define _DEBUG_H_
#include &lt;stdio.h&gt; /* for perror */

#include &quot;err.h&quot;

#ifdef DEBUG
extern unsigned int debug;
#define DPRINTF(level, fmt, args...)                     \
    do {                                                   \
    if ((debug) &amp; (level)) fprintf(stderr, fmt, ##args); \
    } while (0)
#define DEBUG_PERROR(errmsg)                \
    do {                                      \
    if ((debug)&amp;DEBUG_ERRS) perror(errmsg); \
    } while (0)

#define DEBUGDO(level, args) \
    do {                       \
    if ((debug) &amp; (level)) { \
        args;                  \
    }                        \
    } while (0)
#else
#define DPRINTF(args...)
#define DEBUG_PERROR(args...)
#define DEBUGDO(args...)
#endif

/*
    * Debug levels
    */
#define DEBUG_NONE 0x00       // DBTEXT: No debugging
#define DEBUG_ERRS 0x01       // DBTEXT: Verbose error reporting
#define DEBUG_INIT 0x02       // DBTEXT: Debug Initialization
#define DEBUG_SOCKETS 0x04    // DBTEXT: Debug sockets operations
#define DEBUG_PROCESSES 0x08  // DBTEXT: Debug processes operations fork/reap

#define DEBUG_ALL 0xffffffff  // DBTEXT: All debugging

#ifdef __cplusplus
extern &quot;C&quot; {
#endif
int set_debug(char *arg); /* returns 0 on success, -1 on failure */
#ifdef __cplusplus
}
#endif

#endif /* _DEBUG_H_ */
</code></pre>
</details>
<h3 id="调试工具">调试工具</h3>
<h3 id="gdb">gdb</h3>
<p>工作方式：</p>
<ul>
<li>gdb binary 调试二进制程序</li>
<li>gdb binary core 调试崩溃程序的core文件</li>
<li>gdb binary PID  附加到一个正在运行的进程</li>
</ul>
<p>常见功能：</p>
<img src="https://pic.qxxiao.cn/20220430053340.png" alt="ifg" style="zoom:50%;clear:both;display:block;margin:auto" />
<p>说明：</p>
<ol>
<li>没有core文件？</li>
</ol>
<p>使用 <code>ulimit -a</code> 查看资源限制，如果 coredumpsize 的值被设置为零，核心转储将被禁用。可以使用：<code>ulimit -c unlimited</code>  启用，非必要时可以使用 <code>ulimit -c 0</code>  禁用。</p>
<p>Linux下core dump文件通常命名为 core/core.PID；Mac下会存储在 /cores 目录。</p>
<h3 id="追踪系统调用">追踪系统调用</h3>
<p>使用系统调用追踪工具 ktrace(BSD)、strace(Linux).</p>
<p>strace <executable> [args]</p>
<p><strong>strace产生的输出列出了每个系统调用、其参数和结果。s</strong>trace输出对于观察程序崩溃前的最后几个系统调用是非常有用的。</p>
<h3 id="使用valgrind内存调试">使用Valgrind内存调试</h3>
<p>Valgrind是一个动态分析工具（它在你的代码运行时测试你的代码）。它提供的工具可以<strong>检查无效或未初始化的内存使用情况</strong>，在<strong>内存被释放后进行写入</strong>，以及<strong>内存泄漏</strong>。由于它在虚拟机中运行程序，程序在Valgrind下的运行速度要慢10倍左右。Valgrind只在Linux上可用。</p>
<p>valgrind <executable> [args]</p>
<h3 id="使用electric-fence内存调试">使用Electric Fence内存调试</h3>
<p>调试缓冲区越界的工具。它监控对malloc生成的缓冲区的访问，以检测你的代码是否写过了缓冲区的末端（或开始）。</p>
<p>ef <executable> [args]</p>
<p>或者可以使用链接 <code>-lefence</code> 来使用。使用electricfence，试图访问分配内存外的部分将导致程序出现seg故障，而不是引起奇怪的、不可预知的行为。</p>
<h3 id="使用tcpdumpwireshark追踪网络包">使用tcpdump/Wireshark追踪网络包</h3>
<p>对于网络项目和分布式系统的调试，数据包嗅探器如tcpdump和Wireshark可以说是非常有用的。这些工具可以记录进出机器的数据包，并可以解码各种协议。</p>
<ul>
<li>tcpdump是一个更低级的原始数据包接口；它很容易从命令行使用，并产生有用的输出；</li>
<li>Wireshark能解析更多的协议，有更强大的功能（如重新组合TCP流），并且有一个方便的GUI</li>
</ul>
<h3 id="测试输出">测试输出</h3>
<p>对输出进行 &quot;比较 &quot;往往是有帮助（例如文件传输，结果比较）</p>
<ul>
<li>只是传输文本数据
<ul>
<li>用传统的UNIX命令行工具，如wc、diff和grep，更容易地检查它</li>
</ul>
</li>
<li>使用 cmp 命令工具</li>
<li>可视化工具 <a href="http://home.comcast.net/~chris-madsen/vbindiff/">http://home.comcast.net/~chris-madsen/vbindiff/</a></li>
</ul>
<h2 id="文档和风格">文档和风格</h2>
<p>让代码功能显而易见/明显，不要注释明显的代码，尽量保持干净。</p>
<h3 id="风格">风格</h3>
<p>重要的是选择一种风格，并一致地使用它。并且满足：</p>
<ul>
<li>使代码可读性强</li>
<li>能区分重要的东西，如C++中的类名、变量、全局变量等</li>
<li>命名不要过分冗长和痛苦</li>
</ul>
<p>统一使用风格比细节要重要得多。也就是说，随着时间的推移，一些约定俗成的东西已经出现了，它们可以极大地帮助使代码更加可读。例如：</p>
<ul>
<li>IsValid()是一个比checkValid()更好的名字，因为其语义更清晰</li>
<li>在介绍函数时要有简短的注释，<strong>解释其语义</strong>和<strong>任何调用者真正需要知道的关于使用它的信息</strong></li>
</ul>
<h3 id="阅读其他代码">阅读其他代码</h3>
<p>感受编码风格和技巧的一个好方法是阅读一些其他代码。<strong>建议阅读BSD源代码中的一些系统实用程序</strong>。总的来说，它组织得很好，很一致，而且经得起时间的考验。一些建议：</p>
<ul>
<li>ed 测试代码</li>
<li>很多内核代码很有趣，但很密集</li>
</ul>
<h2 id="使用脚本">使用脚本</h2>
<p>时间是宝贵的，将重复性无意义的工作自动化的最好方法是使用脚本语言，如Perl、Python和Ruby。</p>
<h3 id="单行代码">单行代码</h3>
<p>大多数脚本语言都有对 &quot;单行 &quot;的某种支持，可以完成特定的任务，例如将一组文件中出现的 &quot;foo &quot;改为 &quot;bar&quot;：</p>
<p>perl:    perl -pi.bak -e &quot;s/foo/bar/g”</p>
<p>ruby:   ruby -pi.bak -e &quot;gsub(’foo’, ’bar’)”</p>
<p><a href="https://wiki.python.org/moin/Powerful%20Python%20One-Liners">https://wiki.python.org/moin/Powerful Python One-Liners</a></p>
<p><a href="https://www.bashoneliners.com/oneliners/popular/">https://www.bashoneliners.com/oneliners/popular/</a></p>
<h3 id="shell">shell</h3>
<p>掌握shell常见功能，通配符，循环，重定向等等。</p>
<p>以及命令行、面向管道的工具，如 &quot;awk &quot;和 &quot;sed&quot;。</p>
<h2 id="程序设计">程序设计</h2>
<p>程序设计有两个关键的方面是需要解决的：</p>
<ul>
<li>数据结构。该程序对什么数据进行操作？它是如何存储的</li>
<li>模块。程序是如何被划分为各个组件的？这些组件是如何交互的？</li>
</ul>
<p>如何将程序中的功能分解成单个的源代码片段，例如：</p>
<ol>
<li>
<p>不要重复自己的工作DRY</p>
<p>DRY是决定哪些代码应该被拉入模块的经验法则。如果你发现自己不断重复相同或几乎相同的代码，或者更糟糕的是复制和粘贴它！那么是时候考虑把它分离成一个漂亮、干净的模块，可以在其他地方使用。</p>
</li>
<li>
<p>隐藏不必要的实现细节</p>
<p>会使以后改变这些细节更容易，而不需要改变所有使用模块的代码。</p>
</li>
<li>
<p>保持简单!</p>
<p>不要过早地进行优化，不要添加不必要的功能，设计可重用的东西。</p>
</li>
</ol>
<h3 id="为渐进式的快乐而设计">为渐进式的快乐而设计</h3>
<p>极不可能坐下来，在一次不间断的狂欢中，完成整个工作项目。</p>
<p>相反，在开始编码之前，坐下来思考一下你可以沿途采取的渐进步骤。在开发时，以这些渐进的步骤为目标，这样你就可以把问题分解成小的、可管理的块状。你的目标应该是，一旦你开发了一个特定的 &quot;块&quot;，你就可以相信它此后会继续做它的工作。通过如下方法进行分解：</p>
<ul>
<li>识别单独的构件（列表、哈希、算法等）</li>
<li>识别 <strong>特征/基本本质</strong></li>
</ul>
<h3 id="可测试性设计">可测试性设计</h3>
<p>在设计和编码过程中测试的第一个目标是确保一旦你建立了一个特定的组件或模块，你可以依靠这个组件来工作，并保持工作。后来，当你的程序出现错误时，你就可以专注于较新的代码，减少了调试和后期编码的复杂性。</p>
<p><strong>单元测试是测试的最基本元素</strong>。它们特别适合于你在前面将代码分解成步骤时确定的那种完善的模块-实用程序、容器等。对于这些模块中的每一个，我们建议写一套专门针对该模块的测试。编写测试用例可以使你更努力地思考你所暴露的接口和你必须实现的行为。</p>
<p><strong>系统测试是对大局的测试</strong>，注意，即使在这里，你也可以从项目的开始就开始写有用的测试。</p>
<h3 id="对抗的心态">对抗的心态</h3>
<p>在设计测试的时候，要把自己放在真正的、真正的试图破解代码的心态上。<strong>不要只测试简单的情况，要测试边界情况。</strong></p>
<p>先是简单的测试，然后是复杂的测试。很可能在你第一次尝试简单的测试时，你会发现一些错误。一旦你解决了这些问题，就可以继续进行更复杂的测试，以发现更难解决的问题。</p>
<h3 id="测试自动化">测试自动化</h3>
<p>通过这样做，你将更经常地运行它们，将对你更有用。理想情况下，你应该能够类似使用 make test 让你的所有测试运行。</p>
<h2 id="编辑器">编辑器</h2>
<p>了解你的编辑器并对其了如指掌，可以为你节省无数的按键和零星的时间。常见特点：</p>
<ul>
<li>语法高亮。对运算符、函数调用、注释等进行着色，可以使你更容易扫描代码，找到你要找的东西</li>
<li>标签。一些编辑器和集成开发环境（IDE）提供了单次点击或按键命令，让你快速跳转到声明或实现某个函数的文件中。</li>
<li>自动补全。编辑器提供不同类型的自动完成功能，从括号匹配到函数名称自动完成，等等。</li>
</ul>
<p>请注意，当调试涉及多个进程或机器或操作系统内核代码时，一些IDE的集成特性在系统编程的背景下可能对你不利。</p>
<h2 id="阅读">阅读</h2>
<p><a href="https://www.cs.cmu.edu/~dga/systems-se.pdf">https://www.cs.cmu.edu/~dga/systems-se.pdf</a></p>
</div>

                <!-- 新加的模块的，应该使用模版-->
                <!-- 版权声明 -->
                
                  <div class="jumbotron">
                    <div class="container">
                      <p>
                        <i class="ri-article-line"></i>
                        <b>本文链接:</b>
                        <a href="https://blog.qxxiao.eu.org/post/software-engineering-for-systems-hackers/" target="_blank">
                          Software Engineering for Systems Hackers
                        </a>
                      </p>
                      <p>
                        <i class="ri-creative-commons-line"></i>
                        <b>版权声明:</b>
                        本博客所有文章除特别声明外，均采用
                        <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">CC
                          BY-NC-SA
                          4.0</a>
                        许可协议，转载请注明出处。
                      </p>
                      <p>
                        <i class="ri-time-line"></i>
                        <b>发布日期:</b>
                        2022-04-30
                      </p>
                      <p>
                        <i class="ri-time-line"></i>
                        <b>最后更新:</b>
                        <!-- 使用 themeConfig.dateFormat 格式对日期格式化，例如YY-MM-DD -->
                        
                              2022-04-30
                                
                      </p>
                    </div>
                  </div>
                  
                    <!-- 新加的模块的，应该使用模版-->
                    <!--阅读次数-->
                    <div class="text-center text-gray-400">
                      <i class="ri-eye-line"></i>
                      本文已被阅读
                      <span id="twikoo_visitors">0</span>
                      次，该数据仅供参考
                    </div>

                    <!-- Share to Twitter, Weibo, Telegram -->
                    <div class="flex items-center">
                      <div class="mr-4 flex items-center">
                        <i class="ri-share-forward-line text-gray-500"></i>
                      </div>
                      <div
                        class="px-4 cursor-pointer text-blue-500 hover:bg-blue-100 dark:hover:bg-gray-600 inline-flex"
                        @click="shareToTwitter">
                        <i class="ri-twitter-line"></i>
                      </div>
                      <div class="px-4 cursor-pointer text-red-500 hover:bg-red-100 dark:hover:bg-gray-600 inline-flex"
                        @click="shareToWeibo">
                        <i class="ri-weibo-line"></i>
                      </div>
                      <div
                        class="px-4 cursor-pointer text-indigo-500 hover:bg-indigo-100 dark:hover:bg-gray-600 inline-flex"
                        @click="shareToTelegram">
                        <i class="ri-telegram-line"></i>
                      </div>
                    </div>
          </div>

          <!-- 新加的模块的，应该使用模版-->
          <!-- 评论说明-->
          <div class="jumbotron-comment">
            <div class="container">
              <p>
                <i class="ri-message-3-line"></i>
                欢迎任何与文章内容相关并保持尊重的评论😊 !
              </p>
            </div>
          </div>

          
                        
                            
                              <div id="tcomment"></div>
                               <footer class="py-12 text-center px-4 md:px-0" v-pre>
  共 43 篇文章 | Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <i class="ri-rss-line"></i><a href="https://blog.qxxiao.eu.org/atom.xml" target="_blank" target="_blank">RSS</a></br>
©2020-2024 <a href="https://blog.qxxiao.eu.org/index.html" target="_blank">Nuo</a>. All rights reserved.
</footer>

<!--没有添加/用到app 中的主题footer配置消息，如果使用，将上面的 href 替换为原地址-->
<!---->

        </div>

        <!-- TOC Container -->
        <div
          class="fixed right-0 bottom-0 mb-40 mr-4 shadow w-10 h-10 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white dark:bg-gray-500 dark:text-gray-200 hover:shadow-lg transition-all"
          @click="showToc = true">
          <i class="ri-file-list-line"></i>
        </div>

        <div v-cloak
          class="fixed right-0 top-0 bottom-0 overflow-y-auto w-16-24 bg-white dark:bg-gray-800 p-4 border-l border-gray-100 dark:border-gray-600 z-10 transition-fast"
          :class="{ '-mr-64': !showToc }">
          <div class="flex mb-4 justify-end">
            <div
              class="w-8 h-8 inline-flex justify-center items-center rounded-full cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-600 transition-fast"
              @click="showToc = false">
              <i class="ri-close-line text-lg"></i>
            </div>
          </div>
          <div class="post-toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6">版本控制</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96">构建工具和自动化</a>
<ul>
<li><a href="#makefiles">Makefiles</a></li>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#%E5%B7%A5%E5%85%B7">工具</a>
<ul>
<li><a href="#%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5">代码检查</a></li>
</ul>
</li>
<li><a href="#%E8%B0%83%E8%AF%95">调试</a>
<ul>
<li><a href="#%E8%B0%83%E8%AF%95%E6%80%9D%E7%BB%B4%E6%A8%A1%E5%BC%8F">调试思维模式</a></li>
<li><a href="#printf%E8%B0%83%E8%AF%95%E5%AE%8F">Printf：调试宏</a></li>
<li><a href="#%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7">调试工具</a></li>
<li><a href="#gdb">gdb</a></li>
<li><a href="#%E8%BF%BD%E8%B8%AA%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8">追踪系统调用</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8valgrind%E5%86%85%E5%AD%98%E8%B0%83%E8%AF%95">使用Valgrind内存调试</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8electric-fence%E5%86%85%E5%AD%98%E8%B0%83%E8%AF%95">使用Electric Fence内存调试</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8tcpdumpwireshark%E8%BF%BD%E8%B8%AA%E7%BD%91%E7%BB%9C%E5%8C%85">使用tcpdump/Wireshark追踪网络包</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E8%BE%93%E5%87%BA">测试输出</a></li>
</ul>
</li>
<li><a href="#%E6%96%87%E6%A1%A3%E5%92%8C%E9%A3%8E%E6%A0%BC">文档和风格</a>
<ul>
<li><a href="#%E9%A3%8E%E6%A0%BC">风格</a></li>
<li><a href="#%E9%98%85%E8%AF%BB%E5%85%B6%E4%BB%96%E4%BB%A3%E7%A0%81">阅读其他代码</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC">使用脚本</a>
<ul>
<li><a href="#%E5%8D%95%E8%A1%8C%E4%BB%A3%E7%A0%81">单行代码</a></li>
<li><a href="#shell">shell</a></li>
</ul>
</li>
<li><a href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">程序设计</a>
<ul>
<li><a href="#%E4%B8%BA%E6%B8%90%E8%BF%9B%E5%BC%8F%E7%9A%84%E5%BF%AB%E4%B9%90%E8%80%8C%E8%AE%BE%E8%AE%A1">为渐进式的快乐而设计</a></li>
<li><a href="#%E5%8F%AF%E6%B5%8B%E8%AF%95%E6%80%A7%E8%AE%BE%E8%AE%A1">可测试性设计</a></li>
<li><a href="#%E5%AF%B9%E6%8A%97%E7%9A%84%E5%BF%83%E6%80%81">对抗的心态</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E8%87%AA%E5%8A%A8%E5%8C%96">测试自动化</a></li>
</ul>
</li>
<li><a href="#%E7%BC%96%E8%BE%91%E5%99%A8">编辑器</a></li>
<li><a href="#%E9%98%85%E8%AF%BB">阅读</a></li>
</ul>
</li>
</ul>
</div>
        </div>

        <!-- Back to top -->
        <div v-cloak
          class="fixed right-0 bottom-0 mb-20 mr-4 shadow w-10 h-10 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg dark:bg-gray-500 dark:text-gray-200"
          @click="backToUp" v-show="scrolled">
          <i class="ri-arrow-up-line"></i>
        </div>
        <!-- Back to bottom -->
        <div v-cloak
          class="fixed right-0 bottom-0 mb-4 mr-4 shadow w-10 h-10 rounded-full flex justify-center items-center z-10 cursor-pointer bg-white hover:shadow-lg dark:bg-gray-500 dark:text-gray-200"
          @click="backToBottom" v-show="!atBottom">
          <i class="ri-arrow-down-line"></i>
        </div>
    </div>

    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg">
  </div>
  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
    <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
      <div class="pswp__item">
      </div>
    </div>
    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter">
        </div>
        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
        <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut">
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip">
        </div>
      </div>
      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
      </button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
      </button>
      <div class="pswp__caption">
        <div class="pswp__caption__center">
        </div>
      </div>
    </div>
  </div>
</div>

      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
      <script src="https://blog.qxxiao.eu.org/media/scripts/main.js"></script>

      <!-- Code Highlight -->
      
        <script src="https://blog.qxxiao.eu.org/media/prism.js"></script>
        <script>
          Prism.highlightAll();
        </script>
        <script defer
          src="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
        <script defer
          src="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/toolbar/prism-toolbar.min.js"></script>
        <script defer
          src="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/show-language/prism-show-language.min.js"></script>
        <script defer
          src="https://cdn.bootcdn.net/ajax/libs/prism/1.19.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
        

          <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>
          <script>
            //拿到预览框架，也就是上面的html代码
            var pswpElement = document.querySelectorAll('.pswp')[0]
            //定义图片数组变量
            var imgitems
            /**
             * 用于显示预览界面
             * @param index 图片数组下标
             */
            function viewImg(index) {
              var pswpoptions = {
                index: parseInt(index, 10), // 开始幻灯片索引。0是第一张幻灯片。必须是整数，而不是字符串。
                bgOpacity: 0.7, // 背景透明度，0-1
                maxSpreadZoom: 3, // 缩放级别，不要太大
              }
              //初始化并打开PhotoSwipe，pswpElement对应上面预览框架，PhotoSwipeUI_Default为皮肤，imgitems为图片数组，pswpoptions为选项
              var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, imgitems, pswpoptions)
              gallery.init()
            }
            /**
             * 用于添加图片点击事件
             * @param img 图片元素
             * @param index 所属下标（在imgitems中的位置）
             */
            function addImgClick(img, index) {
              img.onclick = function () {
                viewImg(index)
              }
            }
            /**
             * 轮询所有图片，获取src、width、height等数据，加入imgitems，并给图片元素添加事件
             * 最好在onload中执行该方法，本站因放在最底部，所以直接初始化
             * 异步加载图片可在图片元素创建完成后调用此方法
             */
            function initImg() {
              //重置图片数组
              imgitems = []
              //查找class:markdown 下的所有img元素并遍历
              var imgs = document.querySelectorAll('.markdown img')
              for (var i = 0; i < imgs.length; i++) {
                var img = imgs[i]
                //本站相册初始为loading图片，真实图片放在data-src
                var ds = img.getAttribute('data-src')
                //创建image对象，用于获取图片宽高
                var imgtemp = new Image()
                //判断是否存在data-src
                if (ds != null && ds.length > 0) {
                  imgtemp.src = ds
                } else {
                  imgtemp.src = img.src
                }
                //判断是否存在缓存
                if (imgtemp.complete) {
                  var imgobj = {
                    src: imgtemp.src,
                    w: imgtemp.width,
                    h: imgtemp.height,
                  }
                  imgitems[i] = imgobj
                  addImgClick(img, i)
                } else {
                  imgtemp.index = i
                  imgtemp.img = img
                  imgtemp.onload = function () {
                    var imgobj = {
                      src: this.src,
                      w: this.width,
                      h: this.height,
                    }
                    //不要使用push，因为onload前后顺序会不同
                    imgitems[this.index] = imgobj
                    //添加点击事件
                    addImgClick(this.img, this.index)
                  }
                }
              }
            }
            //初始化
            initImg();
          </script>
          
                
                          
                            <script src="https://cdn.jsdelivr.net/npm/twikoo@1.6.36/dist/twikoo.all.min.js"></script>
                            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
                              integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
                              crossorigin="anonymous" />
                            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
                              integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4"
                              crossorigin="anonymous"></script>
                            <script defer
                              src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
                              integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"
                              crossorigin="anonymous"></script>
                            <script>
                              twikoo.init({
                                envId: 'https://twikoo.qxxiao.cn/',
                                el: '#tcomment',
                                katex: {
                                  delimiters: [
                                    { left: '$$', right: '$$', display: true },
                                    { left: '$', right: '$', display: false },
                                    { left: '\\(', right: '\\)', display: false },
                                    { left: '\\[', right: '\\]', display: true },
                                  ],
                                  throwOnError: false,
                                },
                                // region: 'ap-guangzhou', // 环境地域，默认为 ap-shanghai，如果您的环境地域不是上海，需传此参数
                                // path: 'window.location.pathname', // 用于区分不同文章的自定义 js 路径，如果您的文章路径不是 location.pathname，需传此参数
                              });
                            </script>
                            

                              <!-- line number for code block -->
                              <script>
                                var pres = document.getElementsByTagName('pre')
                                for (var i = 0; i < pres.length; i++) {
                                  var pre = pres[i]
                                  if (pre.childNodes[0].nodeName == 'CODE') {
                                    pre.setAttribute('class', 'line-numbers')
                                  }
                                }
                              </script>
                              

  </body>

</html>